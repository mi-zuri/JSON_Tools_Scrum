<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final JSON Result</title>
    <style>
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<h1>Final JSON Result</h1>

<h3>Here is the final JSON:</h3>
<pre id="finalJsonOutput">Loading...</pre>

<!-- Button to start over and redirect to index -->
<form action="/reset" method="POST">
    <button type="submit">Start Over</button>
</form>

<script>
    // Function to get the query parameter from the URL
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

// Function to fetch, decode and display the final JSON from the URL
function displayFinalJson() {
    console.log("Running displayFinalJson()");
    console.log("Full URL:", window.location.href);

// Log the query parameters
console.log("Query Parameters:", window.location.search);
    // Get the encoded JSON from the URL parameter
    const encodedJson = getQueryParam("encodedJson");

    if (!encodedJson) {
        document.getElementById('finalJsonOutput').textContent = 'No JSON found in URL.';
        return;
    }

    try {
        // Decode the URL-encoded JSON string
        const decodedJson = decodeURIComponent(encodedJson);

        // Parse the JSON string into an object
        const jsonObject = JSON.parse(decodedJson);

        // Format the JSON object into a readable format (pretty print)
        const prettyJson = JSON.stringify(jsonObject, null, 2);

        // Display the formatted JSON in the <pre> tag
        const outputElement = document.getElementById('finalJsonOutput');
        if (outputElement) {
            outputElement.textContent = prettyJson;
        } else {
            console.error("Element #finalJsonOutput not found.");
        }
    } catch (error) {
        console.error('Error decoding or parsing JSON:', error);
        document.getElementById('finalJsonOutput').textContent = 'Error decoding or parsing JSON.';
    }
}

displayFinalJson();

</script>

</body>
</html>
